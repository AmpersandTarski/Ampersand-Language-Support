env:
  global:
    secure: m2sFB9qxxe80sfPUD3Asjyaopk49fXmQRz2so23sFagk05f5GJ7ueJYZUhl/2KE5uGv6YQmMCTKMkyLhbdSwD/81Bh6gLWgTIbrPbS9K3QX1j/ZpQQwEYfMJFdTCuCoa7AZly8bQ+x2J1/GZKs5BHejPeYve3SlMYn3bj29rq6Pz6u29T9BQg70Qgp+TGDNNAVLH892/E/rt/rwdFMKyBuz5kLnQCT3bRQWWfUBu2Q3imaLPuxHuBlGgG4/K7DSY6SvFYLsefl9BYfjkHOFk2Uxl8XTo5CcBl38lrncU3uDm3AkVPk/Y7dyAS4/stH3HEHiymvioKHpUoF7pRwDW3g+mg7+O+0iOr9dinbTSgHI/LEmSnCs2R4NZopjBEl1t2QEod/OFsWNyuMSGqq7ec4xz7Vjai4KRaOjpCjWU3Q6d0CbOw0cA7ewY6+yUSS+Hl1gIFf/0cOBP2v1fnJs1Nz+oHqQbZPophUvbn389niT/3Bq7gyb8e6HBRIcTD+gMj356VyPa/rLCqui5B2HDtb3mIIqTOXjm2H+1r/t5Ol7jhR6HprRJAHS2ry+XGOTy7O/DeH6izmRTXg7FQ8knTGBhCXunAYghenD5eJ00qATxuUOx8xhpqj6APjO6gALhR4mIXLT27kNTTZ6j4r3f/x+ksO5yoomT2NCVquf+VTI=

notifications:
  email: false
  webhooks:
    urls:
      - https://www.travisbuddy.com/
    on_success: never
    on_failure: always
    on_start: never
    on_cancel: never
    on_error: never

sudo: false

os:
- osx
- linux

language: node_js

node_js:
- 8

addons:
  apt:
    packages:
      - libsecret-1-dev

before_install:
- if [ $TRAVIS_OS_NAME == "linux" ]; then 
    export CXX="g++-4.9" CC="gcc-4.9" DISPLAY=:99.0;
    sh -e /etc/init.d/xvfb start;
    sleep 3;
    fi

install:
- echo "Installing"
- npm upgrade
- npm install
- npm run vscode:prepublish

script:
- echo "scripting"
- npm test

before_deploy:
- echo "before deploy"
- npm install -g json;
- npm install -g vsce;
- vsce package;
- git tag "test-v$(cat package.json | json version)";

deploy:
- provider: releases
  api_key:
    secure: naSU5fSd+PoIiV4EpDwWchQ3XCAr6PK2TJQbgXXoRhU8WZgvw9++gZ3G8lhbcH7EkSSW7WyBEQQmggJvcUVkcKC9IvpDHFE+Aj2v7LtaAbzH3s7YxcNoVXe54viocSNn+KucdLzTw8QaLQJI0G6mNzMG2m/XCjPby3o/pxsPpl5bw0qsmaySif7Vw0ifMo6yUiYDUfMr1pCoLanW1qZHzhdXZPLS45bcceOGk4NQQ9bM1AmUgVRXv+ns2CpTOYKFgktI+XCys/JJOcCjQ2seNtgxHDmsTKY5J7KSnpl5Bsp0IYAVrzHriVwR/xD6no7OlYInfucreFvJg1MbvCIfZBSdO+UyEtVwDNh5Pv+s6kAsZZ0ZzO59I4PIVFNKorpN9B3ZkGy6U+U0fALU1wOwNabDEuNcqHs99zscjA4eBMgF8m+jfkwm4isG9fz23eXesvMm9fQYYMwpMmwfHmeI5QljTFcVqVmhl3VT8vTjlFMDMzDvRncYmZHmXVN8Jbq0RZAC7EQjt5vmMSHtgBgjNSKm5pYXRXFJrn1qTLGYDJt1tDBNhlk01LKiI8R//5WW69q8DHO67rhKgwZKrDkDMVR8v1WEGtoy2D6BLG0T6KeJaElBXggcLR3SMYQvpBKNDuh/8Z+56KEt2rBIJoFEPokI/sIImd5Gt9ZjV3/rAPo=
  file_glob: true
  file: "*.vsix"
  skip_cleanup: true
  on:
    repo: AmpersandTarski/Ampersand-Language-Support
    branch: travisTest
    condition: $TRAVIS_OS_NAME = linux
# - provider: script
#   script: vsce publish -p $VS_TOKEN
#   skip_cleanup: true
#   on:
#     repo: AmpersandTarski/Ampersand-Language-Support
#     branch: travisTest
#     condition: $TRAVIS_OS_NAME = linux
