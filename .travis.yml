notifications:
  email: false
  webhooks:
    urls:
      - https://www.travisbuddy.com/
    on_success: never
    on_failure: always
    on_start: never
    on_cancel: never
    on_error: never

sudo: false

os:
- osx
- linux

language: node_js

node_js:
- 8

addons:
  apt:
    packages:
      - libsecret-1-dev

before_install:
- if [ $TRAVIS_OS_NAME == "linux" ]; then
    export CXX="g++-4.9" CC="gcc-4.9" DISPLAY=:99.0;
    sh -e /etc/init.d/xvfb start;
    sleep 3;
  fi

install:
- npm install
- npm run vscode:prepublish

script:
- npm test

before_deploy:
- npm install -g json;
- npm install -g vsce;
- vsce package;
- git tag "test-v$(cat package.json | json version)";

deploy:
- provider: releases
  api_key:
    secure: naSU5fSd+PoIiV4EpDwWchQ3XCAr6PK2TJQbgXXoRhU8WZgvw9++gZ3G8lhbcH7EkSSW7WyBEQQmggJvcUVkcKC9IvpDHFE+Aj2v7LtaAbzH3s7YxcNoVXe54viocSNn+KucdLzTw8QaLQJI0G6mNzMG2m/XCjPby3o/pxsPpl5bw0qsmaySif7Vw0ifMo6yUiYDUfMr1pCoLanW1qZHzhdXZPLS45bcceOGk4NQQ9bM1AmUgVRXv+ns2CpTOYKFgktI+XCys/JJOcCjQ2seNtgxHDmsTKY5J7KSnpl5Bsp0IYAVrzHriVwR/xD6no7OlYInfucreFvJg1MbvCIfZBSdO+UyEtVwDNh5Pv+s6kAsZZ0ZzO59I4PIVFNKorpN9B3ZkGy6U+U0fALU1wOwNabDEuNcqHs99zscjA4eBMgF8m+jfkwm4isG9fz23eXesvMm9fQYYMwpMmwfHmeI5QljTFcVqVmhl3VT8vTjlFMDMzDvRncYmZHmXVN8Jbq0RZAC7EQjt5vmMSHtgBgjNSKm5pYXRXFJrn1qTLGYDJt1tDBNhlk01LKiI8R//5WW69q8DHO67rhKgwZKrDkDMVR8v1WEGtoy2D6BLG0T6KeJaElBXggcLR3SMYQvpBKNDuh/8Z+56KEt2rBIJoFEPokI/sIImd5Gt9ZjV3/rAPo=
  file_glob: true
  file: "*.vsix"
  skip_cleanup: true
  on:
    repo: AmpersandTarski/Ampersand-Language-Support
    branch: travisTest
    condition: $TRAVIS_OS_NAME = linux
- provider: script
  script: vsce publish patch -p $VS_TOKEN
  skip_cleanup: true
  on:
    repo: AmpersandTarski/Ampersand-Language-Support
    branch: travisTest
    condition: $TRAVIS_OS_NAME = linux
